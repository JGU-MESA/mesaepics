##=====================================
##=============== Debug ===============
record(stringout, "$(P)$(R)debug")
{
    field(DTYP, "stream")
    field(OUT, "@pm100usb.proto debug $(PORT)")
}

##=====================================
##=============== DeviceID ============
record(stringin, "$(P)$(R)idn")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto idn $(PORT)")
}

##=====================================
##=============== Wavelength ==========
record(ao, "$(P)$(R)wavelength_set")
{
    field(DTYP, "stream")
    field(OUT, "@pm100usb.proto set_wavelength $(PORT)")
    field(EGU, "nm")
    field(LOPR, "350")
    field(HOPR, "1100")
    field(DRVL, "350")
    field(DRVH, "1100")
    field(FLNK, "$(P)$(R)wavelength_get.PROC")
}

record(ai, "$(P)$(R)wavelength_get")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto get_wavelength $(PORT)")
    field(EGU, "nm")
    field(LOPR, "350")
    field(HOPR, "1100")
    field(SCAN, "2 second")
}

##=====================================
##=============== Power ===============
record(ai, "$(P)$(R)pow_get")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto get_power $(PORT)")
    field(EGU, "W")
    field(SCAN, ".2 second")
    field(PREC, "3")
    field(FLNK, "$(P)$(R)ibd_vs_prefl_get PP")
}

record(bi, "$(P)$(R)pow_unit_get")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto get_power_unit $(PORT)")
    field(PINI, "YES")
    field(ZNAM, "W")
    field(ONAM, "DBM")
}

##=====================================
##=============== Current =============
record(ai, "$(P)$(R)i_get")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto get_curr $(PORT)")
    field(EGU, "A")
    field(LOPR, "50e-9")
    field(HOPR, "5e-3")
    #field(SCAN, "1 second")
}

##=====================================
##=============== Voltage =============
record(ai, "$(P)$(R)u_get")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto get_volt $(PORT)")
    field(EGU, "V")
    field(LOPR, "1e-3")
    field(HOPR, "1")
    #field(SCAN, "1 second")
}

##=====================================
##=============== Power Density =======
record(ai, "$(P)$(R)powdens_get")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto get_pdens $(PORT)")
    field(EGU, "W/cm^2")
    field(LOPR, "1e-3")
    field(HOPR, "1")
    #field(SCAN, "1 second")
}

##=====================================
##=============== Zero ================
record(bo, "$(P)$(R)zero_set")
{
    field(DTYP, "stream")
    field(OUT, "@pm100usb.proto set_zero $(PORT)")
    field(FLNK, "$(P)$(R)zero_stat_get")
}

record(bi, "$(P)$(R)zero_stat_get")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto get_zero_state $(PORT)")
    field(ZNAM, "No Zeroing")
    field(ONAM, "Zeroing")
    field(SCAN, "2 second")
}

##=====================================
##=============== Average =============
record(ao, "$(P)$(R)aver_set")
{
    field(DTYP, "stream")
    field(OUT, "@pm100usb.proto set_aver $(PORT)")
    field(DRVL, "1")
    field(DRVH, "100")
    field(LOPR, "1")
    field(HOPR, "100")
    field(FLNK, "$(P)$(R)aver_get")
}

record(ai, "$(P)$(R)aver_get")
{
    field(DTYP, "stream")
    field(INP, "@pm100usb.proto get_aver $(PORT)")
    field(LOPR, "1")
    field(HOPR, "100")
    field(SCAN, "10 second")
}


##=====================================
##=============== CALC Prefl_vs_i======
record(ai, "$(P)$(R)ibd_vs_prefl_slope_set") {
     field(DESC, "Slope of I_bd vs Prefl")
     field(INP, "4.028e-4") # A/W, measured 23.07.18, 9:08
     field(EGU, "A/W")
     field(LOPR, "1e-15")
     field(HOPR, "1e2")
     field(PREC, "3")
     field(FLNK, "$(P)$(R)ibd_vs_prefl_get")
}

record(ai, "$(P)$(R)ibd_vs_prefl_off_set") {
     field(DESC, "I_electron depending on Prefl")
     field(INP, "1.316e-9") # A, measured 23.07.18, 9:08
     field(EGU, "A")
     field(LOPR, "1e-15")
     field(HOPR, "1e-2")
     field(PREC, "3")
     field(FLNK, "$(P)$(R)ibd_vs_prefl_get")
}


record(calc, "$(P)$(R)ibd_vs_prefl_get") {
     field(DESC, "I_electron depending on Prefl")
     field(INPA, "$(P)$(R)ibd_vs_prefl_slope_set") # A/W
     field(INPB, "$(P)$(R)ibd_vs_prefl_off_set") # A
     field(INPC, "$(P)$(R)pow_get") # in W
     field(INPD, "steam:laser:on_get")
     field(EGU, "A")
     field(LOPR, "1e-15")
     field(HOPR, "1e-2")
     field(CALC, "C<0 || D == 0 ? 0 : A*C+B")
     field(PREC, "3")
     field(SCAN, "Passive")
}

