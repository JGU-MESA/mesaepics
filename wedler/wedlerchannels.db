#Load DAC register values into DAC
record(stringout, "$(DEVICE)load_dac")
{
    field (DESC, "Load DAC register values into DAC")
    field (DTYP, "stream")
    field (OUT,  "@wedlkiste.proto loaddac $(DEVICE)")
}

# on/off and error states of a channel
##### wird nicht benutzt #####
record(aai, "$(ELMNT)stats-Chan")
{
    field(DESC, "State of selected channel")
    field(DTYP, "stream")
    field(INP,  "@wedlkiste.proto stateschan($(CHAN)) $(DEVICE)")
    #field(SCAN, "5 second")
    field(FTVL, "USHORT")
    field(NELM, "2")
}

# on/off state of a channel Hajo
record(bi, "$(ELMNT)on_get")
{
    field(DESC, "ON/Off state of selected channel")
    field(DTYP, "stream")
    field(INP,  "@wedlkiste.proto statechanonoff($(CHAN)) $(DEVICE)")
    field(SCAN, "5 second")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
}

# on/off state of a channel Petra  {2, 1, 0} 2=Anzahl der Felder, 1=an, 2=noerror
##### wird nicht benutzt #####
record(mbbi, "$(ELMNT)onoff")
{
    field(DESC, "ON/Off state of selected channel")
    field(DTYP, "stream")
    field(INP,  "@wedlkiste.proto onoff($(CHAN)) $(DEVICE)")
    field(SCAN, "5 second")
    field(ZRST, "OFF")
    field(ONST, "ON")
    field(NIST, "UNDEF")
}

# error state of a channel
record(mbbi, "$(ELMNT)stat_get")
{
    field(DESC, "Error state of selected channel")
    field(DTYP, "stream")
    field(INP,  "@wedlkiste.proto statechanerror($(CHAN)) $(DEVICE)")
    field(SCAN, "5 second")
    #field(ZRST, "NOERROR")
    field(ZRST, "")        #damit im css nichts angezeigt wird, liegt ja kein Fehler vor
    field(ONST, "FUSE ERR")
    field(TWST, "THERM ERR")
    field(THST, "FUSE+THERM ERR")
    field(NIST, "UNDEF")
}

record(bo, "$(ELMNT)on_set")
{
    field(DESC, "Switch on/off one channel")
    field(DTYP, "stream")
    field(OUT,  "@wedlkiste.proto switchchan($(CHAN)) $(DEVICE)")
    field(ZNAM, "OFF")
    field(ONAM, "ON")
}

record(ao, "$(ELMNT)i_set") 
{
    #field(DESC, "Set value")
    field(DESC, "Set DAC value of a channel")
    field(OROC, "0")
    field(DTYP, "stream")
    field(OUT,  "@wedlkiste.proto setdacval($(CHAN)) $(DEVICE)")
    field(FLNK, "$(DEVICE)load_dac")        #nach jedem Setzen eines DAC Wertes, wird er in das DAC-Register geladen
    field(SCAN, "Passive")
    field(LINR, "LINEAR")
#These fields are adjustment parameters for the raw output values.
#They are applied to the raw output value after conversion from engineering units.
    field(ASLO, "2.44148075808e-4")          # 8A / 32767 ASLO = Adjustment Slope
    field(EGUL, "0")                         # Engineering Units Low
    field(EGUF, "8")    # highest eng. value # Engineering Units Full
    field(EGU,  "A")
    field(PREC, "4")
    field(DRVL, "-8")   # max value
    field(DRVH, "8")    # min value
    field(LOPR, "-8")   # min display
    field(HOPR, "8")   # max display
}

record (calcout, "calc") {
  field(INPA, "$(ELMNT)i_set CP")
  field(INPB, "$(ELMNT)i_set.OVAL CP")
  field(CALC, "A!=B?6:0")
  field(OOPT, "On Change")
  field(OUT,  "$(ELMNT)i_set.SCAN")
}

record(ai, "$(ELMNT)inom_get")
{
    field(DESC, "Get DAC value of element")
    field(DESC, "Read DAC register value of a channel")
    field(DTYP, "stream")
    field(INP,  "@wedlkiste.proto getdacval($(CHAN)) $(DEVICE)")
    field(SCAN, "10 second")
    field(LINR, "LINEAR")
    field(ASLO, "2.44148075808e-4")   # 8A / 32767
    field(EGUL, "0")
    field(EGUF, "8")
    field(EGU,  "A")
    field(PREC, "4")
    field(HOPR, "8")                # max display
    field(LOPR, "-8")               # min display
    field(FLNK, "$(ELMNT)devi")  # process devi after read
}

record(ai, "$(ELMNT)i_get")
{
    field(DESC, "Read measured current of a channel")
    field(DTYP, "stream")
    field(INP, "@wedlkiste.proto getact($(CHAN),$(ELMNT)vrdy) $(DEVICE)")
    field(SCAN, "10 second")
    field(LINR, "LINEAR")
    field(ASLO, "2.44148075808e-4")   # 8A / 32767
    field(EGUL, "0")
    field(EGUF, "8")
    field(EGU,  "A")
    field(PREC, "4")
    field(HOPR, "8")
    field(LOPR, "-8")
    field(FLNK, "$(ELMNT)devi")  # process devi after read
}

record(ai, "$(ELMNT)u_get")
{
    field(DESC, "Read measured voltage of a channel")
    field(DTYP, "stream")
    field(INP,  "@wedlkiste.proto getvolt($(CHAN),$(ELMNT)vrdy) $(DEVICE)")
    field(SCAN, "10 second")
    field(LINR, "LINEAR")
    field(ASLO, "2.44148075808e-4")   # 8A / 32767
    field(EGUL, "0")
    field(EGUF, "8")
    field(EGU,  "V")
    field(PREC, "4")
    field(HOPR, "8")
    field(LOPR, "-8")
}

record(calc, "$(ELMNT)devi")
{
    field(DESC, "Diff nominal-actual")
    field(INPA, "$(ELMNT)inom_get")
    field(INPB, "$(ELMNT)i_get")
    field(INPC, "$(ELMNT)vrdy")
    field(INPD, "1000")
    field(CALC, "(A - B) * C * D")
    field(EGU,  "mA")
    field(HOPR, "1000")
    field(LOPR, "-1000")
    field(PREC, "4")
    field(HIHI, "500")
    field(LOLO, "-500")
    field(HIGH, "100")
    field(LOW,  "-100")
    field(LLSV, "MAJOR")
    field(LSV,  "MINOR")
    field(HSV,  "MINOR")
    field(HHSV, "MAJOR")
}

# Messwert aktuell
record(bi, "$(ELMNT)vrdy") {
    field(ZNAM, "UNREADY")
    field(ONAM, "READY")
}
